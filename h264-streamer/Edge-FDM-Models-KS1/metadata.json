{
    "name": "Edge FDM Models KS1",
    "description": "BigEdge FDM fault detection models for Kobra S1 (448x224 RGB color, ImageNet normalization, Feb 2026)",
    "input": "448x224 RGB color (TJPF_RGB), ImageNet mean/std baked into RKNN config",
    "calibration": "RGB (matching on-device TJPF_RGB input)",
    "models": {
        "cnn": {
            "display_name": "KS1 SupCon T=0.05 MMSE",
            "onnx": "model.onnx",
            "rknn": "model.rknn",
            "training": "SupCon 2-stage KS1 dataset v4 (temp=0.05, 100+50 epochs, 540 fail + 2499 success)",
            "dataset": "datasets/KS1/ks1printer",
            "quantization": "MMSE (handles SupCon weight outliers)",
            "source": "candidate_models/results/supcon-ks1-temp005-v4/"
        },
        "protonet": {
            "display_name": "KS1 ProtoNet Color SupCon Temp 0.05",
            "onnx": "encoder.onnx",
            "rknn": "encoder.rknn",
            "prototypes": "prototypes.bin",
            "training": "SupCon KS1 dataset (temp=0.05, 100 epochs, 540 fail + 2499 success)",
            "dataset": "datasets/KS1/ks1printer",
            "spatial_fine": {
                "onnx": "spatial_encoder.onnx",
                "rknn": "spatial_encoder.rknn",
                "prototypes": "spatial_prototypes.bin",
                "grid": "14x28",
                "channels": 128,
                "training": "Proj+QAT+MMSE (1x1 Conv 232→128 projection + QAT, cos_sim=0.594, 106x improvement)",
                "quantization": "MMSE",
                "source": "protonet/weights/spatial-ks1-proj-qat-mmse/fine/"
            },
            "spatial_coarse": {
                "onnx": "spatial_encoder_coarse.onnx",
                "rknn": "spatial_encoder_coarse.rknn",
                "prototypes": "spatial_prototypes_coarse.bin",
                "grid": "7x14",
                "channels": 256,
                "training": "Proj only (1x1 Conv 1024→256 projection, cos_sim=-0.998, margin=1.998, 2.17x improvement over baseline 0.920)",
                "quantization": "normal (MMSE/QAT add nothing — projection alone saturates coarse encoder)",
                "source": "protonet/weights/spatial-ks1-proj-normal/coarse/",
                "comparison": {
                    "baseline_no_proj": {"channels": 1024, "cos_sim": 0.080, "margin": 0.920},
                    "proj_normal": {"channels": 256, "cos_sim": -0.998, "margin": 1.998},
                    "proj_mmse": {"channels": 256, "cos_sim": -0.998, "margin": 1.998},
                    "proj_qat_normal": {"channels": 256, "cos_sim": -0.996, "margin": 1.996},
                    "proj_qat_mmse": {"channels": 256, "cos_sim": -0.996, "margin": 1.996},
                    "decision": "Proj (normal) — simplest pipeline, best result. QAT/MMSE add nothing for coarse."
                }
            },
            "source": "protonet/weights/supcon-ks1/"
        },
        "multiclass": {
            "display_name": "KS1 Multiclass Color SupCon 7-class",
            "onnx": "multiclass.onnx",
            "rknn": "multiclass.rknn",
            "classes": ["Cracking", "Layer_shifting", "Spaghetti", "Stringing", "Success", "Under_Extrusion", "Warping"],
            "training": "SupCon 2-stage KS1-augmented multiclass_7c (temp=0.05, 100+50 epochs, 10230 images)",
            "dataset": "datasets/KS1/multiclass_7c_ks1",
            "quantization": "MMSE",
            "test_results": {
                "mc_acc": 0.962,
                "macro_f1": 0.960,
                "bin_f1": 0.979,
                "best_epoch": 38
            },
            "source": "multiclass_cnn/scripts/results/mc-ks1-temp005/"
        }
    },
    "profiles": {
        "KS1": {
            "description": "Kobra S1 calibrated (Feb 2026)",
            "cnn_threshold": 0.40,
            "cnn_dynamic_threshold": 0.35,
            "proto_threshold": 0.58,
            "proto_dynamic_trigger": 0.70,
            "multi_threshold": 0.81,
            "heatmap_boost_threshold": 1.6,
            "live_test_results_v4": {
                "date": "2026-02-26",
                "note": "After KS1-trained multiclass upgrade (SupCon T=0.05, MMSE, 10230 images from multiclass_7c + KS1 ks1printer)",
                "empty_bed": {"cnn": "0.01", "proto": "-0.83 to -0.86", "heatmap": "0.07-0.49", "multi": "0.04 Success"},
                "object_on_bed": {"cnn": "0.06", "proto": "-0.70 to -0.80", "heatmap": "0.75-1.24", "multi": "0.31-0.34 Success"},
                "big_spaghetti_on_object": {"cnn": "0.81-0.82", "proto": "+0.85 to +0.88", "heatmap": "2.13-2.14", "multi": "0.976 Spaghetti"},
                "small_spaghetti_on_object": {"cnn": "0.87-0.89", "proto": "+0.89 to +0.90", "heatmap": "2.09-2.11", "multi": "0.955-0.958 Spaghetti"},
                "small_spaghetti_center": {"cnn": "0.75-0.76", "proto": "+0.90-0.91", "heatmap": "2.09-2.11", "multi": "0.924-0.936 Spaghetti"},
                "gap_cnn": "worst_OK=0.06 vs best_FAULT=0.75 (gap=0.69)",
                "gap_proto": "worst_OK=-0.70 vs best_FAULT=+0.85 (gap=1.55)",
                "gap_heatmap": "worst_OK=1.24 vs best_FAULT=2.09 (gap=0.85)",
                "gap_multi": "worst_OK=0.34 vs worst_FAULT=0.93 (gap=0.60, was 0.26 in v3)",
                "multiclass_improvement": "KS1-trained multiclass doubles gap (0.60 vs 0.26). Empty bed 0.04 vs 0.50. Small spaghetti+object 0.96 vs 0.76 (was below 0.81 threshold). All fault scenarios now clear 0.81 threshold comfortably.",
                "verdict": "Multiclass massively improved by KS1-specific training. Threshold 0.81 well-centered. All models agree on all scenarios."
            },
            "live_test_results_v3": {
                "date": "2026-02-26",
                "note": "After coarse projection upgrade (256ch, cos_sim=-0.998) + fine Proj+QAT+MMSE (128ch, cos_sim=0.594). Old generic multiclass.",
                "empty_bed": {"cnn": "0.01-0.02", "proto": "-0.87", "heatmap": "-0.68 to 0.20", "multi": "0.50 Success"},
                "object_on_bed": {"cnn": "0.05", "proto": "-0.78 to -0.86", "heatmap": "-0.65 to 0.26", "multi": "0.47 Success"},
                "big_spaghetti_on_object": {"cnn": "0.72", "proto": "+0.84 to +0.86", "heatmap": "2.11-2.13", "multi": "0.93-0.94 Spaghetti"},
                "small_spaghetti_on_object": {"cnn": "0.92", "proto": "+0.90", "heatmap": "2.08-2.09", "multi": "0.76 Spaghetti (below 0.81 th)"},
                "gap_cnn": "worst_OK=0.05 vs best_FAULT=0.72 (gap=0.67)",
                "gap_proto": "worst_OK=-0.78 vs best_FAULT=+0.84 (gap=1.62)",
                "gap_heatmap": "worst_OK=0.26 vs best_FAULT=2.08 (gap=1.82)",
                "heatmap_improvement": "Coarse projection (1024→256ch, cos_sim=-0.998) produces anti-correlated prototypes. Heatmap gap improved from 0.70 (v2) to 1.82 (v3) — 2.6x. Values now exceed 1.0 for faults (raw cosine margin, not probability). OK values go negative.",
                "verdict": "Heatmap massively improved. CNN/Proto gaps stable. All thresholds remain well-centered."
            },
            "live_test_results_v2": {
                "date": "2026-02-26",
                "note": "After Proj+QAT+MMSE fine spatial encoder upgrade (128ch, cos_sim=0.594). Before coarse projection.",
                "empty_bed": {"cnn": "0.01-0.02", "proto": "-0.85 to -0.87", "heatmap": "0.14-0.19", "multi": "0.41-0.44 Success"},
                "object_on_bed": {"cnn": "0.04", "proto": "-0.82 to -0.86", "heatmap": "0.14-0.17", "multi": "0.42-0.44 Success"},
                "big_spaghetti_on_object": {"cnn": "0.77-0.78", "proto": "+0.90", "heatmap": "0.89-0.93", "multi": "0.97 Spaghetti"},
                "small_spaghetti_on_object": {"cnn": "0.90-0.91", "proto": "+0.88 to +0.89", "heatmap": "0.93-0.94", "multi": "0.73 Spaghetti (below 0.81 th)"},
                "gap_cnn": "worst_OK=0.04 vs best_FAULT=0.77 (gap=0.73)",
                "gap_proto": "worst_OK=-0.82 vs best_FAULT=+0.88 (gap=1.70)",
                "gap_heatmap": "worst_OK=0.19 vs best_FAULT=0.89 (gap=0.70)",
                "heatmap_improvement": "Old fine encoder (232ch, cos_sim=0.996): empty bed heatmap 0.55-0.63, triggered spatial boost false positives. New (128ch, cos_sim=0.594): empty bed 0.14-0.19, well below 0.45 boost threshold.",
                "verdict": "All thresholds well-centered. Multiclass at 0.81 is correct — generic model has FP risk on objects if lowered."
            },
            "live_test_results_v1": {
                "date": "2026-02-26",
                "note": "Before Proj+QAT+MMSE upgrade (old 232ch fine encoder, cos_sim=0.996)",
                "empty_bed": {"cnn": "0.04-0.05", "proto": "-0.80 to -0.84", "heatmap": "0.18-0.22"},
                "object_on_bed": {"cnn": "0.03-0.08", "proto": "-0.78 to -0.88", "heatmap": "0.16-0.27"},
                "big_spaghetti": {"cnn": "0.81-0.82", "proto": "+0.87 to +0.88", "heatmap": "0.90-0.91", "multi": "0.95 Spaghetti"},
                "small_spaghetti_on_object": {"cnn": "0.92", "proto": "+0.88 to +0.89", "heatmap": "0.94-0.95", "multi": "0.81 borderline"},
                "small_spaghetti_center": {"cnn": "0.75-0.77", "proto": "+0.82 to +0.86", "heatmap": "0.94-0.96", "multi": "0.86 Spaghetti"},
                "gap_cnn": "worst_OK=0.08 vs best_FAULT=0.75 (gap=0.67)",
                "gap_proto": "worst_OK=-0.78 vs best_FAULT=+0.82 (gap=1.60)"
            }
        }
    }
}
