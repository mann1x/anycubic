<!DOCTYPE html><html><head><title>H264 Streamer</title>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<style>
body{font-family:sans-serif;margin:20px;background:#1a1a1a;color:#fff}
.container{max-width:800px;margin:0 auto}
h1{color:#4CAF50;margin-bottom:5px}
.subtitle{color:#888;margin-bottom:20px}
.section{background:#2d2d2d;padding:15px;margin:15px 0;border-radius:8px}
.section h2{margin:0 0 10px 0;color:#888;font-size:14px;text-transform:uppercase}
button{background:#4CAF50;color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-size:14px;margin:2px}
button:hover{background:#45a049}
button.secondary{background:#555}
button.secondary:hover{background:#666}
.stream-row{display:flex;align-items:center;margin:8px 0;padding:8px;background:#222;border-radius:4px}
.stream-url{flex:1;font-family:monospace;font-size:13px;color:#4CAF50;word-break:break-all}
.stream-btns{display:flex;gap:5px}
.stream-btns button{padding:5px 10px;font-size:12px}
.copy-btn{background:#444;padding:5px 8px !important}
.copy-btn:hover{background:#555}
.endpoint-row{display:flex;margin:6px 0;padding:6px 0;border-bottom:1px solid #333}
.endpoint-path{font-family:monospace;color:#4CAF50;min-width:180px}
.endpoint-desc{color:#aaa;font-size:13px}
.copied{background:#2e7d32 !important}
</style></head><body>
<div class='container'>
<h1>H264 Streamer</h1>
<p class='subtitle'>HTTP streaming server for Anycubic printers</p>

<div class='section'>
<h2>Control Panel</h2>
<p style='color:#aaa;margin:0 0 10px 0;font-size:14px'>Configure streaming settings, camera controls, and preview video.</p>
<button onclick='openControl()'>Open Control Panel</button>
</div>

<div class='section'>
<h2>Video Streams</h2>
<div id='streams'></div>
</div>

<div class='section'>
<h2>API Endpoints</h2>
<p style='color:#888;font-size:12px;margin:0 0 10px 0'>Available on control port (<span id='cp'>$control_port</span>)</p>
<div class='endpoint-row'><span class='endpoint-path'>/control</span><span class='endpoint-desc'>Web control panel with settings and preview</span></div>
<div class='endpoint-row'><span class='endpoint-path'>/api/stats</span><span class='endpoint-desc'>JSON stats (FPS, CPU, clients)</span></div>
<div class='endpoint-row'><span class='endpoint-path'>/api/config</span><span class='endpoint-desc'>JSON full running configuration</span></div>
<div class='endpoint-row'><span class='endpoint-path'>/status</span><span class='endpoint-desc'>Plain text status summary</span></div>
<div class='endpoint-row'><span class='endpoint-path'>/timelapse</span><span class='endpoint-desc'>Timelapse management page</span></div>
<div class='endpoint-row'><span class='endpoint-path'>/api/timelapse/list</span><span class='endpoint-desc'>JSON list of timelapse recordings</span></div>
<div class='endpoint-row'><span class='endpoint-path'>/api/camera/controls</span><span class='endpoint-desc'>JSON camera controls with ranges</span></div>
<div class='endpoint-row'><span class='endpoint-path'>/api/touch</span><span class='endpoint-desc'>POST touch events to printer LCD</span></div>
</div>
</div>

<script>
var sp=$streaming_port,cp=$control_port;
var host=location.hostname;
var streamBase='http://'+host+':'+sp;
var ctrlBase='http://'+host+':'+cp;
function openControl(){window.open(ctrlBase+'/control','_blank')}
function openStream(url){window.open(url,'_blank')}
function copyText(text,btn){
var ta=document.createElement('textarea');
ta.value=text;ta.style.position='fixed';ta.style.left='-9999px';
document.body.appendChild(ta);ta.select();
try{document.execCommand('copy');
btn.classList.add('copied');btn.textContent='Copied!';
setTimeout(function(){btn.classList.remove('copied');btn.textContent='Copy'},1500)
}catch(e){alert('Copy failed: '+text)}
document.body.removeChild(ta)}
function addStream(name,url){
var d=document.getElementById('streams');
var r=document.createElement('div');r.className='stream-row';
var u=encodeURIComponent(url);
r.innerHTML='<span class="stream-url">'+url+'</span>'+
'<div class="stream-btns"><button onclick="openStream(decodeURIComponent(\''+u+'\'))" class="secondary">Open</button>'+
'<button onclick="copyText(decodeURIComponent(\''+u+'\'),this)" class="copy-btn">Copy</button></div>';
d.appendChild(r)}
addStream('MJPEG Stream',streamBase+'/stream');
addStream('Snapshot',streamBase+'/snapshot');
addStream('H.264 FLV','http://'+host+':18088/flv');
addStream('Display Stream',streamBase+'/display');
addStream('Display Snapshot',streamBase+'/display/snapshot');
</script></body></html>
